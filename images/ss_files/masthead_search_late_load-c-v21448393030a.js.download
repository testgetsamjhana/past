require(['ta/rollupAmdShim'], function(rollupAmdShim) {rollupAmdShim.install(["typeahead/TypeAhead.utils","typeahead/TypeAhead.views","Logging","dual_search/DualSearch","dual_search/behaviour/Submit","dual_search/view/DimmerOverlay","dual_search/view/Default","dual_search/view/LoadingState","dual_search/aux/OverviewItems","dual_search/aux/Logging"],[]);});
if(window.requirejs && requirejs.taConfig)requirejs.taConfig({"deferred":{},"name":"build/concat/masthead_search_late_load","files":{"js-amd":{"src":{"Logging":1,"dual_search":{"view":{"DimmerOverlay":1,"LoadingState":1,"Default":1},"aux":{"Logging":1,"OverviewItems":1},"behaviour":{"Submit":1},"DualSearch":1}}},"js3":{"src":{"typeahead":{"TypeAhead.utils":1,"TypeAhead.views":1}}}},"_":{"baseUrl":"/"}});
define("typeahead/TypeAhead.utils",["vanillajs","ta/util/Deferred","utils/ajax"],function(e,t,o){var n={};return n.query=function(e,n,a,r,i,l,s,u,c,_,d,g,m){return function(e){var f=t(),h={query:e,action:"API",startTime:this.startTime,uiOrigin:this.name,source:this.name,interleaved:!0,geoPages:!i,flightsToPages:!i,nearPages:!1,details:!0,types:n||"geo,hotel,eat,attr,vr",link_type:r||n||"geo,hotel,eat,attr",max:l||12,neighborhood_geos:!!u,requiredFields:s};if(""!==a?(h.nearby=!0,h.local=!0,h.parentids=a):h.global=!0,_&&""!==_&&(h.scopeFilter=_),d&&"[object Array]"===Object.prototype.toString.call(d)&&d.length>0&&(h.filter=d.join(",")),g)for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p]);if(sessionStorage&&m){var y=JSON.parse(sessionStorage.getItem("mapRect"));y&&(h.max_lat=y.max_lat,h.max_lon=y.max_lon,h.min_lat=y.min_lat,h.min_lon=y.min_lon)}return new o({method:"GET",url:"/TypeAheadJson",data:h,error:function(){c?f.reject(JS_location_not_found):f.reject(JS_location_not_found)},success:function(e){c?e&&e.results&&e.results.length>0&&f.resolve(e)||f.reject(JS_location_not_found):e&&f.resolve(e)||f.reject(JS_location_not_found)}}),f.promise()}},n});
define("typeahead/TypeAhead.views",["vanillajs","ta/util/Deferred","utils/object/set-props","ta/util/I18N"],function(e,s,a,t){var i={};i.iconMap={ALL:"sprite-typeahead-all",GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-vr",FLIGHTS_TO:"sprite-typeahead-flight",AIRPORT:"sprite-typeahead-flight",AIRLINE:"sprite-typeahead-flight",THEME_PARK:"sprite-typeahead-themepark",VACATION_PACKAGE:"sprite-typeahead-hotel",SMART_DEAL:"sprite-typeahead-hotel",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"sprite-typeahead-neighborhood",TRAVEL_GUIDE:"sprite-typeahead-travel-guide"},i.iconFontMap={ALL:"ui_icon globe-world",GEO:"ui_icon map-pin-fill",HOTELOVERVIEW:"ui_icon map-pin-fill",HOTEL:"ui_icon hotels",ATTRACTION:"ui_icon attractions",EATERY:"ui_icon restaurants",VACATION_RENTAL:"ui_icon vacation-rentals",FLIGHTS_TO:"ui_icon flights",AIRPORT:"ui_icon flights",THEME_PARK:"ui_icon amusement-parks",VACATION_PACKAGE:"ui_icon hotels",SMART_DEAL:"ui_icon hotels",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"ui_icon neighborhoods",TRAVEL_GUIDE:"ui_icon guides",AIRLINE:"ui_icon flights",SHIP:"ui_icon cruises",CRUISE_LINE:"ui_icon cruises",CAR_RENTAL_OFFICE:"ui_icon rental-cars",KEYWORD:"ui_icon search",TAG:"ui_icon search",ACTIVITY:"ui_icon activities",NEARBY:"ui_icon nearby",NEAR_POI:"ui_icon map-pin-fill",UNIVERSITY:"ui_icon classes-workshops",TRAIN_STATION:"ui_icon train",USER_PROFILE:"ui_icon friend-fill",USER_PROFILE_VERIFIED:"ui_icon verified-checkmark",PAGE:"ui_icon search",SHOPPING:"ui_icon shopping-bag",PORT:"ui_icon ports",GENERAL_HOSPITAL:"ui_icon hospital",FERRY:"ui_icon cruises",CORPORATION:"ui_icon office"};var r={PAGE:!0,BLENDER_PAGE:!0,NEAR_POI:!0,VACATION_PACKAGE:!0,SMART_DEAL:!0,FLIGHTS_TO:!0,USER_PROFILE:!0},n={FLIGHTS_TO:!0,VACATION_PACKAGE:!0};i.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")};var o=function(e,s){var a={},t=[];return e.forEach(function(e){var s=e.type;a[s]=a[s]||[],a[s].push(e)}),s.forEach(function(e){var s=a[e];if(s)for(var i=0;i<s.length;i++)t.push(s[i])}),t};i.configTypeAheadOptionsForSortingByPOIType=function(e,a){var t=e.postResultsFnList||[];t.push(function(e){var t=s();return e.results=o(e.results,a),t.resolve(e),t.promise()}),e.postResultsFnList=t,e.listTemplate=function(e){var s=e.results,a=[];if(s.length>0){a.push("<ul>"),s.forEach(function(){var e="";return function(s){if(e!=s.type){e=s.type;var a=[s.rendered];a.push('<span class="label">'),a.push(s.title),a.push('<img src="/img2/x.gif" class="icon hidden" alt="">'),a.push("</span>"),s.rendered=a.join("")}}}());var t=function(){var e="",s=document.createElement("div");return function(a){var t='<li class="typeahead-choice '+i.escapeHTML(a.title.toLowerCase())+'">'+a.rendered+"</li>";return e!=a.type&&(e=a.type,s.innerHTML=t,s.firstChild.className+=" first",t=s.innerHTML),t}}();a.push(s.map(t).join("")),a.push("</ul>")}return a.join("")}};var l={showChildren:!1,tagLabels:null,poiClasses:"",geoClasses:""};return i.itemTemplate=function(e){e=a(l,e);var s=e.useIconFont,o=s?i.iconFontMap:i.iconMap,p=function(e,s){var a="";if(e&&Object.keys(e).length>0){var t=e[s];a=t||e.values()[0]}return a};return function(a,l){var u,c=[],h="url_small",d="",v="";l=l||{};var _=a.details||a,g=_.highlighted_name||_.name||"",f="TAG"===a.data_type||"local_tag"===a.scope||"overview"===a.scope||e.simpleChild&&a.isChild,y=f?"":_.geo_name||"";if("NEAR_POI"===a.data_type&&(g=a.find_near_name),l.HTMLEscape&&(g=i.escapeHTML(g),y=i.escapeHTML(y)),!a.isChild){a.isNeighborhood?u=o.NEIGHBORHOOD:"NEAR_POI"===a.data_type?u=o.NEAR_POI:"USER_PROFILE"===a.data_type?(v=a.avatar?p(a.avatar,h):"",u=o.USER_PROFILE+(v?" user-avatar":""),d=v?'<span class="ui_avatar labeled-profile-icon small"><img src="'+v+'" class=""></span>':""):u="PAGE"===a.data_type?o.PAGE:"TAG"===a.data_type?o[a.data_type]:o[a.type];var E=a.icon_type||a.data_type;if(E&&n[E.toUpperCase()]&&(u=o[E.toUpperCase()]),!s&&u&&E&&r[E]&&(u+="-list"),u){var T=(s?"":"sprite-image ")+"leftIcon "+u;c.push('<div class="'+T+'">'+d+"</div>")}}var R,A=e.tagLabels;A&&(a.isChild&&a.parent&&a.parent.moved?R=A.newLocation:a.moved===!0?R=A.moved:a.closed===!0&&(R=A.closed));var L="poi-name "+e.poiClasses;y||(L+=" no-geo"),"NEAR_POI"===a.data_type&&(L+=" near_poi"),d&&(L+=" user-avatar"),R&&(L+=" tagged-poi");var I="geo-name "+e.geoClasses;c.push('<div class="main-content">');var O=a.document_id;if(O&&(O=i.escapeHTML(a.document_id)),c.push('<div class="first-row" docId="'+O+'">'),c.push('<span class="'+L+'">'),e.debug&&(c.push('<span class="debug">'),c.push("number"==typeof a.order?a.order:"??"),c.push("("+("number"==typeof a.score?a.score:"??")+")"),c.push("&nbsp;</span>")),c.push(g),"USER_PROFILE"===a.data_type&&a.details.verified===!0){var m=" detailIcon "+o.USER_PROFILE_VERIFIED;c.push("<span>&nbsp;</span>"),c.push('<span class="'+m+'"></span>')}if(c.push("</span>"),R&&c.push('<div class="tag-container"><span class="search-tagged-poi" >'+R+"</span></div>"),c.push("</div>"),c.push('<div class="second-row">'),"USER_PROFILE"===a.data_type){var b=e.geoClasses,C=d?" user-avatar":"";if(c.push('<span class="'+b+C+'">'),c.push('<span class="username">'+a.details.user_name+"</span>"),a.details.followers){c.push("<span>&nbsp;&bull;&nbsp;</span>");var H="";t.isRtl()&&(H=' dir="rtl"'),a.following?c.push("<span"+H+">"+a.following+"</span>"):c.push("<span"+H+">"+a.details.followers+"</span>")}c.push("</span>"),c.push("</div>")}else y?(c.push('<span class="'+I+'">'+y+"</span>"),c.push("</div>")):c.pop();if(c.push("</div>"),e.showChildren&&a.isChild){c.unshift('<div class="child'+(R?" tagged-poi":"")+'">'),c.push("</div>");var N=a.lastChild?o.CHILD_BOTTOM:o.CHILD_TOP,P="sprite-image childIcon leftIcon "+N;c.unshift('<div class="'+P+'"></div>')}return c.join("")}},i.configureTypeAheadForSegmentedResults=function(e,a){var t=a||{},r=t.boldSearchQuery,n=t.groupByScope,o=e.postResultsFnList||[],l="search",p="rescue",u="history",c="suggested",h="overview",d="global",v="local",_="brands",g="hotels",f=function(e){var s={},a=function(e){return e.data_type&&"SEARCH"===e.data_type.toUpperCase()?p:e.type&&"SEARCH"===e.type.toUpperCase()?l:"history"==e.scope?u:"suggested"==e.scope?c:"overview"==e.scope?h:e.scope&&0===e.scope.lastIndexOf("local",0)?v:n&&"global"==e.scope?v:e.data_type&&"ADDRESS"===e.data_type.toUpperCase()?v:"brands"==e.scope?_:"hotels"==e.scope?g:d};return e.forEach(function(e){var t=a(e);if("history"!==t||!e.isChild){var i=s[t]=s[t]||[];i.push(e)}}),s};return o.push(function(e){var a=s();return t.debug&&e.results.forEach(function(e,s){e.order=s}),e.results=function(e){var s=[];e.forEach(function(e){if(s.push(e),e.children)for(var a=e.children.length,t=0;t<a;t++){var i=e.children[t];i.scope=e.scope,i.parent=e,s.push(i)}});for(var a=f(s),t=[],i=[h,u,c,v,d,l,_,g,p],r=0;r<i.length;r++){var n,o=i[r];n=a[o],n&&(t=t.concat(n))}return t}(e.results),a.resolve(e),a.promise()}),e.postResultsFnList=o,e.listTemplate=function(e){var s=[],a=e.results,n=f(a),o=!1,y=!1,E=!1,T=0==a.length,R=!(e.query&&e.query.query||n[v]&&0!==n[v].length||n[d]&&0!==n[d].length),A=function(e,a){var t="resultContainer"+(a?" "+a:"");s.push('<ul class="'+t+'">');for(var i=0;i<e.length;i++){var r=e[i];r&&(s.push('<li class="'+(r.wrapperCSS||"")+'">'),s.push(r.rendered),s.push("</li>"))}s.push("</ul>")};if(n[h]&&n[h].length>0&&(E=!0,t.overviewLabel&&s.push('<div class="title overview">'+t.overviewLabel+"</div>"),A(n[h],"overview")),n[u]&&n[u].length>0&&(o=!0,t.historyLabel&&s.push('<div class="title history">'+t.historyLabel+"</div>"),A(n[u],e.query?null:"history bold_names")),n[c]&&n[c].length>0&&(s.push('<div class="title history">'+t.suggestedLabel+"</div>"),A(n[c],"suggested")),!R&&t.localLabel&&(n[v]&&n[v].length>0||t.noResultsMessage&&!E)&&(y=!0),n[_]&&n[_].length>0){n[_];!e.integrated&&t.brandsLabel&&s.push('<div class="title">'+t.brandsLabel+"</div>"),A(n[_])}if(n[g]&&n[g].length>0&&(t.hotelsLabel&&s.push('<div class="title">'+t.hotelsLabel+"</div>"),A(n[g])),n[v]&&n[v].length>0?(y=!0,A(n[v],"local")):y&&t.showNoResultsMessage&&s.push('<div class="no-results">'+t.noResultsMessage+"</div>"),n[d]&&n[d].length>0&&(t.globalLabel&&(y||o||t.alwaysShowGlobal)&&s.push('<div class="title global">'+t.globalLabel+"</div>"),A(n[d],"global")),!R&&n[l]&&n[l].length>0){var L=n[l][0],I=e.query&&e.query.query||"",O="search resultContainer";L.noResults&&(O+=" noResults"),r?s.push('<ul class="'+O+'"><li class="searchRow">'+L.name.replace("%","<b>"+i.escapeHTML(I)+"</b>")+"</div></li></ul>"):s.push('<ul class="'+O+'"><li class="searchRow">'+i.escapeHTML(L.name.replace("%",I))+" &raquo;</div></li></ul>")}return n[p]&&n[p].length>0&&A(n[p],"rescue"),T&&!R&&t.showNoResultsMessage&&t.noResultsMessage&&s.push('<div class="no-results">'+t.noResultsMessage+"</div>"),s.join("")},t},i.simpleItemTemplate=function(){return function(e){return[e.details.name,'<span class="addr">',e.details.address,"</span>"].join("")}},i.simpleListTemplate=function(e){return function(s){if(!s.results||!s.results.length)return'<div class="noResults">'+e+"</div>";var a,t=s.results||[],i=["<ul>"];return t.forEach(function(e){i.push("<li>"),e.title!==a&&(a=e.title,i.push('<span class="label">',a,'<img src="/img2/icons/typeahead/',e.type.slice(0,1).toLowerCase(),'.gif"/></span>')),i.push(e.rendered),i.push("</li>")}),i.push("</ul>"),i.join("")}},i.ptptListTemplate=function(e){function s(e){var s="history"==e.scope,a=e.type?e.type.toLowerCase():"",t=s?"history":a;return{historyScope:s,choiceType:a,headerType:t}}for(var a=['<div class="typeahead-choices">'],t={},i={history:!0},r=CDNHOST+"/img2/x.gif",n=e.results,o=n.length,l=0;l<o;l++){var p=n[l],u=s(p),c="typeahead-choice "+u.choiceType,h=!1;u.headerType in t||(c+=" first",t[u.headerType]=!0,h=!0),u.historyScope&&(c+=" history"),a.push('<div class="'+c+'">'),a.push('<img src="'+r+'" class="icon" alt="">'),a.push('<span class="cutoff">'),a.push(p.rendered),a.push("</span>"),u.historyScope&&a.push('<img src="'+r+'" class="history_icon" alt="">'),a.push("</div>");var d=n[l+1],v=d&&s(d);v&&i[u.headerType]&&v.headerType!=u.headerType&&a.push('<div class="divider"></div>')}return a.push("</div>"),a.join("")},i});
define("Logging",[],function(){var e="undefined"!=typeof IS_DEBUG&&IS_DEBUG?4:1;"boolean"==typeof __SERVER__&&__SERVER__&&(e=4);for(var n={},o=["error","warn","dir","info","debug"],r=0;r<o.length;r++){var l=o[r];n[l]=function(n,o){return function(){e<o||"undefined"!=typeof console&&console[n]&&console[n].apply&&console[n].apply(console,Array.prototype.slice.call(arguments))}}(l,r)}return n.setLevel=function(n){e=n},n});
define("dual_search/DualSearch",["api-mod","Logging","mixins/mixin","mixins/Events","ta/util/Error","ta/util/Deferred","ta/Core/TA.Store","ta/util/LocalStorage","dual_search/geolocation","common/Radio"],function(e,t,o,a,i,n,r,h,s,l){"use strict";var c=l("SRPAutoScope"),p=function(e,t){if(t.isNeighborhood&&t.details&&t.details.parent_ids&&t.details.parent_ids.length>0){var o=t.details.parent_ids[0];return e.replace("-g1-","-g"+o+"-zfn"+t.value+"-")}return"/Flights"===e?e+"-g"+t.value:e.replace("-g1-","-g"+t.value+"-")},d=function(e){h.canUseLocalStore()&&(localStorage.lastSearchWasWorldwide=e,localStorage.lastSearchWasNearby=!e)},u=function(){var e=document.getElementById("DEFAULT_SCOPE_FOR_SINGLE_SEARCH");return!(!e||!e.value)},g=function(h,l){function c(){return w.selection&&!w.selection.partial&&!w.selection.tabSelection}function m(e){var t=document.getElementById("SINGLE_SEARCH");return!(!(t&&t.value&&e)||"overview"!==e.scope&&"local_keyword"!==e.scope&&"local_tag"!==e.scope)&&(w.is_single_search_redirect=!0,!0)}if(o(this,a.create([].concat(g.inputEvents,g.emitEvents))),h.debug){t.setLevel(3);var I=this.emit;this.emit=function(e){t.info("DualSearch: emit ",e,arguments),I.apply(w,Array.prototype.slice.call(arguments))}}this.options=h,this.whatTypeahead=h.whatTypeahead,this.whereTypeahead=h.whereTypeahead,g.inputEvents.forEach(function(e){"function"==typeof this[e]&&this.on(e,this[e])},this),this.whereTypeahead=h.whereTypeahead,this.whatTypeahead=h.whatTypeahead,this.options=h,this.geoInfo=null,this.explicitWorldwideGeoSelection=null,this.selection=null;var w=this;if(this.navigating=!1,this.whereTypeahead&&this.whatTypeahead){var S=function(e,t){if(t==w.whatTypeahead&&(w.selection=null),t.getInputLength(!0)<(h.minCharsForSearch||1)){var o=n(),a={results:[],normalized:{query:e}};return o.resolve(a),o.promise()}return t.searchFn(e)};this.whatTypeahead.options.search=S,this.whereTypeahead.options.search=S,this.whatTypeahead.options.onSelect=function(t,o,a,i,n,r){if(!(!t||c()||u()&&m(t))){var s={choice:t,partial:!0,tabSelection:"tab"===n,url:null,context:"masthead_what",evt:r};1!=w.geoInfo.geoID&&(s.geo=w.geoInfo.geoID);var l=function(){w.selection=e.merge({},s),"local_keyword"===t.scope&&delete w.selection.url,w.emit("select",a,s)},p=function(){w.emit("selectWhatField",a,s)};"string"==typeof t.type&&"SEARCH"===t.type.toUpperCase()?s.search=!0:t.url?(s.url=t.url,w.geoInfo.nearby||h.isSingleSearchEnabled&&"tab"===n||(w.setGeoInfoFromWhatChoice(t),1!==w.geoInfo.geoID&&(s.geo=w.geoInfo.geoID))):s.category=t.type.toUpperCase(),(s.geo>1||w.geoInfo.nearby||"AIRLINE"===t.type||"SHIP"===t.type||"USER_PROFILE"===t.type||"CRUISE_LINE"===t.type||"SEARCH"===t.type&&"SEARCH"===t.data_type)&&(s.partial=!1),w.geoInfo.geoID&&w.geoInfo.nearby&&"PAGE"===t.data_type&&(s.whatQuery=w.whatTypeahead.getNormalizedQuery(),s.partial=!1,s.url=null),l(),p(),s.partial&&(w.stopWhatSearch(),w.startWhereSearch(!1)),m(t)}},this.whereTypeahead.options.onSelect=function(t,o,a,i,n,h){if(t&&!c()){for(var l={},u=t.urls,g=0;u&&g<u.length;g++){var f=u[g];l[f.type]={url:f.url,fallback_url:f.fallback_url}}var y=function(o){var i={choice:t,geo:o.geoInfo.geoID,partial:!0,tabSelection:"tab"===n||h&&"blur"===h.type,url:null,evt:h,context:"masthead_where"},r=function(){o.selection={choice:o.selection&&o.selection.choice||i.choice,geo:i.geo,url:i.url,category:o.selection&&o.selection.category,partial:i.partial,context:i.context,tabSelection:i.tabSelection,evt:i.evt,search:o.selection&&o.selection.search},o.emit("select",a,e.merge({},i))};if(o.selection){if(o.selection.partial&&o.selection.category&&l[o.selection.category]){var s=l[o.selection.category].fallback_url;if(s)return i.url=s,i.partial=!1,void r()}if(o.selection.partial&&o.selection.url&&t.value&&t.value>1&&"AIRPORT"!=t.type)return i.url=p(o.selection.url,t),i.partial=!1,void r()}var c=o.whatTypeahead.getNormalizedQuery();return c?(i.whatQuery=c,i.partial=!1,void r()):(r(),void(h&&"blur"===h.type&&"tab"!==n?o.stopSearch():(o.stopWhatSearch(),o.startWhatSearch(!1))))},m=function(e,t,o){return e.whereTypeahead.disableOnBlur=!0,e.emit("enabled",!1),e.whereTypeahead.disableOnBlur=!1,s.fetchCoordinates(!0)},I={geoID:1,geoName:null,parentName:null,categories:null,shortParentName:null,isNeighborhood:null,type:null,position:null,nearby:!1};if(t.value)I.geoID=t.value,I.geoName=t.details.name,I.parentName=t.details.geo_name,I.categories=l,I.shortParentName=t.details.parent_name,I.isNeighborhood=t.isNeighborhood,I.type=t.type,I.nearby=!1,void 0!==I.geoID&&(w.explicitWorldwideGeoSelection=!1),w.setGeoInfoFromObj(I),d(!1),y(w);else{var S=function(){I.nearby=!1,I.geoID=1,w.explicitWorldwideGeoSelection=!0,w.setGeoInfoFromObj(I),d(!0),y(w)};t.isLatLong&&r.retrieve("typeahead.enable_nearby")?(I.geoName=t.name,I.nearby=!0,I.geoID=0,w.explicitWorldwideGeoSelection=!0,m(w,t,I).then(function(e){w.emit("enabled",!0),t.latitude=e.latitude,t.longitude=e.longitude,I.position=e.latitude+","+e.longitude,w.setGeoInfoFromObj(I),d(!1),y(w),w.submit(null,!0)})["catch"](function(e){w.emit("enabled",!0);var t=r.retrieve("typeahead.scoped.cur_loc_denied");t&&alert(t),S()})):S()}}},this.whatTypeahead.options.onSelectNavigate=function(){(c()||w.is_single_search_redirect&&!w.navigating)&&w.submit(null,!0)},this.whereTypeahead.options.onSelectNavigate=function(){c()&&!w.navigating&&w.submit(null,!0)},this.whatTypeahead.options.onRender=f.bind(this,"what"),this.whereTypeahead.options.onRender=f.bind(this,"where"),h.geoInfo?this.setGeoInfo(h.geoInfo.geoId,h.geoInfo.geoName,h.geoInfo.parentName,h.geoInfo.categories,h.geoInfo.shortParentName,h.geoInfo.isNeighborhood,h.geoInfo.type,h.geoInfo.position,h.geoInfo.nearby):this.clearGeoInfo(),l&&Array.isArray(l)||(l=Array.prototype.slice.call(arguments,1));for(var v=0;v<l.length;v++)try{l[v]&&l[v].call(this)}catch(e){i.record(e,"DualSearch mixin "+v)}this.whatTypeahead.options=e.merge(this.whatTypeahead.options,{onShow:w.emit.bind(this,"dropdownShown",this.whatTypeahead),onHide:w.emit.bind(this,"dropdownHidden",this.whatTypeahead),doSelectionBeforeLogging:!0}),this.whereTypeahead.options=e.merge(this.whereTypeahead.options,{onShow:w.emit.bind(this,"dropdownShown",this.whereTypeahead),onHide:w.emit.bind(this,"dropdownHidden",this.whereTypeahead),doSelectionBeforeLogging:!0,shouldSubmit:function(){return!1}})}this.startWhereSearch=function(e){y(this)||this.whereTypeahead.showStaticResultsIfEnabled(),this.emit("startSearch",e,this.whereTypeahead,"where")},this.stopWhereSearch=function(){this.whereTypeahead.hide()},this.startWhatSearch=function(e){this.whatTypeahead.hasBeenShown||this.whatTypeahead.showStaticResultsIfEnabled(),this.emit("startSearch",e,this.whatTypeahead,"what")},this.stopWhatSearch=function(){this.whatTypeahead.hide()},this.whereTypeahead.options.clearquery=function(){w.clearGeoInfo()}};g.inputEvents=[],g.emitEvents=["startSearch","stopSearch","dropdownShown","dropdownHidden","resultsRendered","select","geoUpdated","submit","enabled"];var f=function(e,t,o){0===o.length&&t.hide(),this.emit("resultsRendered",t,o,e)};g.prototype.clearGeoInfo=function(){this.setGeoInfo()},g.prototype.setGeoInfoFromWhatChoice=function(e){if(e.details&&e.details.parent_name&&e.details.parent_ids&&e.details.parent_ids.length>1){var t=e.details.parent_ids[0],o=e.details.parent_name,a=e.details.grandparent_name;this.setGeoInfo(t,o,a,{},a,!1)}},g.prototype.setGeoInfo=function(e,t,o,a,i,n,r,h,s){var l=void 0!==e,c=this.geoInfo&&this.geoInfo.getId,p={geoID:s?0:e||1,geoName:t||"",parentName:o||"",shortParentName:i||"",categories:{},isNeighborhood:!!n,type:r,explicitSelection:l,nearby:!!s};h&&(p.position=h);for(var d in a)if(a.hasOwnProperty(d)){var g=a[d];g.url&&(p.categories[d]=g)}this.geoInfo=p;var f;h?(this.whatTypeahead.setCurrentPosition(h,s),f=!0):f=c!==p.geoID,f&&(s||this.whatTypeahead.setCurrentPosition(null,!1),1===p.geoID?this.whatTypeahead.setGeoId(null):this.whatTypeahead.setGeoId(this.geoInfo.geoID)),u()&&this.whatTypeahead.setGeoId(null),this.emit("geoUpdated",this.geoInfo,f)},g.prototype.setGeoInfoFromObj=function(e){this.setGeoInfo(e.geoID,e.geoName,e.parentName,e.categories,e.shortParentName,e.isNeighborhood,e.type,e.position,e.nearby)},g.prototype.submit=function(e,t){if(!ta)return!0;var o=!!e;e=e||this.selection&&this.selection.evt;var a=this,i=function(){a.navigating=!0,setTimeout(function(){a.navigating=!1,a.selection&&(a.selection.partial=!0)},1e4)};if(this.selection&&!this.selection.partial&&this.selection.url)return i(),this.emit("submit",{evt:e,redirectUrl:this.selection.url,context:this.selection.context,submit_clicked:o}),!1;var n=this.whatTypeahead.getNormalizedQuery()||this.whatTypeahead.getInputText(),r=this.geoInfo.geoID>1||this.geoInfo.nearby;if(!n||!r){if(!n)return this.stopWhereSearch(),this.startWhatSearch(!1),!1;r||this.geoInfo.nearby&&void 0!==this.geoInfo.position&&this.setGeoInfoFromObj(this.geoInfo)}return i(),this.emit("submit",{evt:e,submit_clicked:o}),!1},g.prototype.focusWhere=function(e,t){this.stopWhatSearch(),this.startWhereSearch(!0)},g.prototype.focusWhat=function(e,t){this.stopWhereSearch(),this.startWhatSearch(!0)},g.prototype.stopSearch=function(e,t){this.stopWhatSearch(),this.stopWhereSearch(),this.emit("stopSearch")};var y=function(e){return e.whatTypeahead.hasBeenShown||e.whereTypeahead.hasBeenShown};return g.prototype.resetNavigation=function(){this.navigating=!1,this.selection&&(this.selection.partial=!0)},g.prototype.submitClicked=function(e){e.preventDefault(),this.submit(e,!1)},c.on("setAutoScoped",function(e){var t=document.getElementById("AUTO_SCOPED");t&&(e?t.value="true":t.value="false")}),g});
define("dual_search/behaviour/Submit",["vanillajs","ta/common/Search"],function(e,t){"use strict";return function(e){var n=document.getElementById("global_nav_search_form"),o=function(e,t){function n(e){if(e){var t,n=e.length,o=e.lastIndexOf("?");return e.indexOf("Search")>=0?e:t=o<0?e+"?from_tpa=true":e.substring(0,o+1)+"from_tpa=true&"+e.substring(o+1,n)}}window.location=n(e)},i=function(e,o,i){var a=this.whatTypeahead.getInputText();a&&(document.getElementById("MASTHEAD_MAIN_QUERY").value=a);var l=!0,u=document.getElementById("mainSearch"),r=document.getElementById("TOURISM_REDIRECT");return this.geoInfo&&this.geoInfo.geoID>1&&!a&&u&&r&&(r.value="true",u.value=""),t.recordAndValidate(e,n,l,this.whatTypeahead,!o,i)},a=function(e){var t=document.getElementById("TYPEAHEAD_GEO_ID"),n=document.getElementById("TYPEAHEAD_LATITUDE"),o=document.getElementById("TYPEAHEAD_LONGITUDE"),i=document.getElementById("TYPEAHEAD_NEARBY"),a=document.getElementById("AUTO_SCOPED"),l=e&&1!=e.geoID?this.geoInfo.geoID:null;e&&e.position&&2===e.position.split(",").length?(n.value=e.position.split(",")[0],o.value=e.position.split(",")[1]):(n.value=null,o.value=null),e&&e.nearby?(i.value="true",t.value=null):(i.value=null,t.value=l),e&&l&&a&&(a.value="false")};return function(){this.whatTypeahead.options.doSelectionBeforeLogging=this.whereTypeahead.options.doSelectionBeforeLogging=!0,this.whereTypeahead.options.doSelectionBeforeLogging=this.whereTypeahead.options.doSelectionBeforeLogging=!0,this.on("geoUpdated",a);var t=function(t){t.redirectUrl?o(t.redirectUrl,t.context):i.call(this,t.evt,t.submit_clicked,e)};this.on("submit",t.bind(this))}}});
define("dual_search/view/DimmerOverlay",["lib/jquery-amd"],function(i){"use strict";return function(){var n,e=function(){n=i('<div class="pageDimOverlay scopeSearchOverlay"></div>'),n.append(i('<div class="inner"></div>')),i(document.body).append(n);var e=function(){var e=i("#PAGE");n.css({width:e.width(),height:e.height()})};e(),i(window).on("resize",e)},t=function(){n&&n.show()||e()},r=function(i){n&&n.hide()};return function(){this.on("startSearch",t.bind(this,!0)),this.on("stopSearch",r.bind(this))}}});
define("dual_search/view/Default",["lib/jquery-amd","api-mod","ta/Core/TA.Store"],function(e,t,o){"use strict";return function(i,a,s,n,r,l){var d={no_results_found:o.retrieve("typeahead.noResultsFound"),all_of_trip:o.retrieve("typeahead.scoped.all_of_trip"),worldwide_title:o.retrieve("typeahead.worldwide"),recently_viewed:o.retrieve("typeahead.history"),current_location:o.retrieve("typeahead.scoped.cur_loc"),typeahead_transport_error:window.JS_location_not_found},h=function(e){var t;t=e.geoID>1?this.geoInfo.geoName+(this.geoInfo.shortParentName?", "+this.geoInfo.shortParentName:""):e.explicitSelection?e.position&&e.nearby?d.current_location:d.all_of_trip:"",window.setTimeout(function(){a.value=t},0)},p=function(t,o,i){this.whereTypeahead===i&&(e(".twoFieldFocus").removeClass("twoFieldFocus"),e("."+t).addClass("twoFieldFocus"),e(".tablet_desktop").length&&e(".hintHeader").length&&window.scrollTo(0,e(".hintHeader").offset().top),e(a).prop("placeholder",e(".geoExample").html()))},c=function(e,t){if(!e){var o=t==this.whatTypeahead?n:a;o&&document.activeElement!=o&&(o.focus(),o.select()),setTimeout(function(){o&&document.activeElement!=o&&(o.focus(),o.select())},200)}},u=function(t,o){if(t.container&&""===t.container.innerHTML)return void t.hide();var i=e(".displayItem.history",t.container).length>0;e(t.container).toggleClass("titleTop",i),e(".search-tagged-poi").each(function(t,o){o=e(o);var i=o.width();[o.siblings(".poi-name")[0],o.siblings(".geo-name")[0]].forEach(function(t){if(t){t=e(t);var o=t.css("max-width").replace("px","");if(o.indexOf("%")>=0){o=o.replace("%","");var a=t.parent("li").width();o=a*(o/100)}var s=t.css("margin-left").replace("px",""),n=20;t.css("max-width",o-i-s-n+"px")}})})};return e([a,n]).removeClass("focusClear"),function(){var a={width:null,positionRelative:"top",offsetX:0,offsetY:0};e.extend(this.whatTypeahead.options,a),this.whatTypeahead.options.errorTemplate=function(){return d.typeahead_transport_error},this.whatTypeahead.options.itemSelector="li",this.whereTypeahead.options.itemSelector="li";var n=function(){var e={showChildren:!0,tagLabels:{newLocation:o.retrieve("typeahead_new_location_label"),moved:o.retrieve("typeahead_moved_label"),closed:o.retrieve("typeahead_closed_label")},poiClasses:"primaryText",geoClasses:"secondaryText",useIconFont:!0,simpleChild:!0,debug:r};return function(t,o){if(!o.details&&"SEARCH"!==o.data_type)return"";var i="displayItem";return i+="history"==o.scope?" history":"overview"==o.scope?" overview"+(t?" short_cell":""):"local_tag"==o.scope||"local_keyword"==o.scope?" overview short_cell":" result",o.isChild&&(i+=" simpleChild"),o.wrapperCSS=i,TypeAhead.views.itemTemplate(e)(o,{HTMLEscape:!1})}}();this.whatTypeahead.options.itemTemplate=t.bind(n,this,!0),this.whereTypeahead.options.itemTemplate=t.bind(n,this,!1),e.extend(this.whereTypeahead.options,a),this.whereTypeahead.options.errorTemplate=function(){return""},this.whatTypeahead.options.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(this.whatTypeahead.options,{noResultsMessage:d.no_results_found,globalLabel:d.worldwide_title,historyLabel:d.recently_viewed,resultClassWrap:"",groupByScope:!0,boldSearchQuery:!0,debug:r}),this.whereTypeahead.options.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(this.whereTypeahead.options,{localLabel:null,noResultsMessage:d.no_results_found,globalLabel:d.worldwide_title,historyLabel:d.recently_viewed,showNoResultsMessage:!0,groupByScope:!0,boldSearchQuery:!0,debug:r}),this.on("geoUpdated",h),this.on("startSearch",p.bind(this,"geoScopeContainer")),this.on("startSearch",c.bind(this)),this.on("select",function(t,o){o.partial||e("#SEARCH_BUTTON").focus()}),this.on("dropdownShown",function(t){var o=t==this.whatTypeahead?s:i;e(o).addClass("dropdownVisible"),l||e(t.container).css("width",o.clientWidth)}),this.on("dropdownHidden",function(t){e(t==this.whatTypeahead?s:i).removeClass("dropdownVisible")}),this.on("resultsRendered",u);var w=!1;this.on("submit",function(){w=!0});var f=this,y=function(t){var o=e(t.target).closest("#GEO_SCOPE_CONTAINER, #MAIN_SEARCH_CONTAINER");o.length||w||f.stopSearch()};e(document.body).on("click",y).on("focus",y),e(window).on("blur",y)}}});
define("dual_search/view/LoadingState",["vanillajs","api-mod"],function(i,n){"use strict";var e=function(i){var e=n.find("#GEO_SCOPED_SEARCH_INPUT"),t=n.find("#mainSearch"),d=n.find("#SEARCH_BUTTON"),a=n.find("#DUAL_SEARCH_LOADER_CONTAINER");n.toggleClass(a,"active",!i);var s=i?"":"disabled";e&&(e.disabled=s),t.disabled=s,d.disabled=s},t=function(i,n){(i&&n.submit_clicked||n.redirectUrl)&&(e(!1),setTimeout(function(){e(!0)},1e4))};return function(i){return function(){this.on("submit",t.bind(null,i!==!1)),this.on("enabled",e)}}});
define("dual_search/aux/OverviewItems",["vanillajs","api-mod","utils/geolocation","ta/Core/TA.Store","ta/util/String"],function(e,t,a,r,o){"use strict";return function(e){var i=!e,s=function(e){if(e){var t=r.retrieve("typeahead.aliases."+e);if(t)return t}return[]},n={hotels_text:r.retrieve("typeahead.hotel_list"),hotel_text:r.retrieve("typeahead.hotel"),restaurants_text:r.retrieve("typeahead.restaurant_list"),restaurant_text:r.retrieve("typeahead.restaurant"),vacation_rentals_text:r.retrieve("typeahead.vacation_rental_list"),vacation_rental_text:r.retrieve("typeahead.vacation_rental"),flights_text:r.retrieve("typeahead.flight_list"),all_of_trip:r.retrieve("typeahead.scoped.all_of_trip"),current_location:r.retrieve("typeahead.scoped.cur_loc"),static_local_label:r.retrieve("typeahead.scoped.static_local_label"),title_text:r.retrieve("typeahead.scoped.result_title_text"),worldwide_title:r.retrieve("typeahead.worldwide"),area_title:r.retrieve("typeahead.scoped.geo_area_template"),restaurants:r.retrieve("typeahead.restaurant_list"),hotels:r.retrieve("typeahead.hotel_list"),vacation_rentals:r.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:r.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:r.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:r.retrieve("typeahead.scoped.poi_vr_geo"),poi_hotels_geo_near:r.retrieve("typeahead.scoped.poi_hotels_geo_near"),poi_vr_geo_near:r.retrieve("typeahead.scoped.poi_vr_geo_near"),poi_attractions_geo:r.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:r.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:r.retrieve("typeahead.scoped.poi_flights_geo"),poi_nbrhd_geo:r.retrieve("typeahead.scoped.poi_nbrhd_geo"),poi_travel_guides_geo:r.retrieve("typeahead.scoped.poi_travel_guides_geo"),overview_text:r.retrieve("typeahead.scoped.overview"),neighborhoods_text:r.retrieve("typeahead.scoped.neighborhoods"),things_to_do_text:r.retrieve("typeahead.things_to_do"),travel_guides_text:r.retrieve("typeahead.scoped.travel_guides")},p=function(){function e(e){return a.map(function(a){var r=t.merge({},a);return r.scope=e,r})}var a=r.retrieve("typeahead.popularDestinations")||r.retrieve("typeahead.recentHistoryList")||[];return e("history")},_=function(){function e(e){return a.map(function(a){var r=t.merge({},a);return r.scope=e,r})}var a=r.retrieve("typeahead.localAirports")||[];return e("airports")},l=function(e,t,a,r,i){r=r||a;var n=e.categories[t];if(n||e.geoID&&1!==e.geoID||(n={}),n){var p=TypeAhead.views.escapeHTML(e.geoName),_="";e.isNeighborhood&&e.shortParentName&&(_=", "+TypeAhead.views.escapeHTML(e.shortParentName));var l=r.replace("%",p),h=a.replace("%",p+_),d=document.createElement("span");return d.innerHTML=a.replace("%",p),{name:l,normalized_name:o.stripHTMLFromText(h).trim(),type:t,details:{name:h},scope:"overview",url:n.url,data_type:"GEO"===t?"LOCATION":"PAGE",icon_type:"LOCATION",scoped_render:d,aliases:s(i)}}};return function(){function e(e,r){var o=p(),i={name:n.all_of_trip,normalized_name:n.all_of_trip,type:"ALL",scope:"overview",details:{name:n.all_of_trip}};if(o.unshift(i),n.current_location&&a.canRequestLocation()&&o.unshift({name:n.current_location,normalized_name:n.current_location,type:"NEARBY",scope:"overview",details:{name:n.current_location},isLatLong:!0}),e&&1!=e.geoID&&0!=e.geoID){o=o.filter(function(t){return t.value!=e.geoID});var s=[];for(var _ in e.categories)if(e.categories.hasOwnProperty(_)){var l=e.categories[_];l=t.merge(l),l.type=_,s.push(l)}var h={value:e.geoID,name:e.geoName,type:"GEO",isNeighborhood:e.isNeighborhood,details:{name:e.geoName,geo_name:e.parentName,parent_name:e.shortParentName,isNeighborhood:e.isNeighborhood},scope:"overview",urls:s};o.splice(0,0,h)}r.addStaticResults("history",{results:o,types:["geo","all","nearby"],showOnEmpty:!0,integrate:!1,getMatchingKey:function(e){return e.url},maxItems:6})}var o=this,s=this.geoInfo,h=p();this.whatTypeahead.addStaticResults("history",{results:h,types:["accommodation","attraction","eatery","vacation_rental","airport","theme_park","airline","hotel","restaurant","ship","cruise_line","car_rental_office"],showOnEmpty:!0,integrate:!1,predicate:function(e){return 1==s.geoId||e.details&&e.details.parent_ids&&e.details.parent_ids.indexOf(s.geoID)>=0},shouldReplace:function(e){return"PAGE"!=e.data_type},getMatchingKey:function(e){return e.url},maxItems:5}),e(s,this.whereTypeahead);var d=_();this.whereTypeahead.addStaticResults("local_airports",{results:d,types:["airport"],showOnEmpty:!1,integrate:!0,getMatchingKey:function(e){return e.url},maxItems:1,bottom:!0,minChars:3});var c=function(t,a){if(t){a&&(o.whereTypeahead.clearResults(),e(t,o.whereTypeahead));var s=[],p=t.type&&"AIRPORT"==t.type,_=t.categories&&t.categories.HOTEL&&t.categories.HOTEL.url.indexOf("HotelsNear")>-1,h=t.categories&&t.categories.VACATION_RENTAL&&t.categories.VACATION_RENTAL.url.indexOf("VacationRentalsNear")>-1;1!=t.geoID?(o.whatTypeahead.options.scopeFilter="global",o.whatTypeahead.options.viewOptions.globalLabel=null,o.whatTypeahead.options.viewOptions.localLabel=n.area_title.replace("%",o.geoInfo.geoName),a&&(s.push(l(t,"GEO",n.poi_overview_geo,n.overview_text,"")),s.push(l(t,"HOTEL",p||_?n.poi_hotels_geo_near:n.poi_hotels_geo,n.hotels_text,"hotels")),r.retrieve("isDaoDao")||s.push(l(t,"VACATION_RENTAL",p||h?n.poi_vr_geo_near:n.poi_vr_geo,n.vacation_rentals_text,"vacation_rentals")),s.push(l(t,"ATTRACTION",n.poi_attractions_geo,n.things_to_do_text,"things_to_do")),s.push(l(t,"EATERY",n.poi_eat_geo,n.restaurants_text,"restaurants")),s.push(l(t,"TRAVEL_GUIDE",n.poi_travel_guides_geo,n.travel_guides_text,"travel_guides")),s.push(l(t,"NEIGHBORHOOD",n.poi_nbrhd_geo,n.neighborhoods_text,"")),r.retrieve("typeahead.flight_enabled")&&s.push(l(t,"FLIGHTS_TO",n.poi_flights_geo,n.flights_text,"flights")))):(o.whatTypeahead.options.scopeFilter=null,o.whatTypeahead.options.viewOptions.globalLabel=n.worldwide_title,o.whatTypeahead.options.viewOptions.localLabel=null,a&&(s.push(l(t,"HOTEL",'<span class="poi_overview_item">'+n.hotels_text+"</span>",void 0,"hotels")),r.retrieve("isDaoDao")||s.push(l(t,"VACATION_RENTAL",'<span class="poi_overview_item">'+n.vacation_rentals_text+"</span>")),s.push(l(t,"ATTRACTION",'<span class="poi_overview_item">'+n.things_to_do_text+"</span>",void 0,"things_to_do")),s.push(l(t,"EATERY",'<span class="poi_overview_item">'+n.restaurants_text+"</span>",void 0,"restaurants")),r.retrieve("typeahead.flight_enabled")&&s.push(l(t,"FLIGHTS_TO",'<span class="poi_overview_item">'+n.flights_text+"</span>",void 0,"flights")))),s=s.filter(function(e){return!!e}),a&&i&&(o.whatTypeahead.clearCache(),o.whatTypeahead.addStaticResults("overview",{results:s,getMatchingKey:function(e){return e.url||e.index},types:[],integrate:!0,showOnEmpty:!0,maxItems:8}))}};this.on("geoUpdated",c),this.on("stopGeoSearch",c),s&&c(s,!0)}}});
define("dual_search/aux/Logging",["vanillajs","api-mod","ta/Core/TA.Record","utils/ajax"],function(e,t,o,a){"use strict";return function(e,n,r,i){var s,c=function(e){o.trackEventOnPage(e.module,e.action,e.context,e.value)},d=function(e){o.addGARecordMevt(e.module,e.action,e.context,e.value,e.url)},u=null,h=function(e,t){e=e||"/Search",t=t||"masthead";var a=e;a&&a.indexOf("?")>0&&(a=a.substring(0,a.indexOf("?"))),a&&a.indexOf("-")>0&&(a=a.substring(0,a.indexOf("-"))),a=a.replace("/","");var n=t+" | "+a,r={module:"desktop_typeahead",action:"typeahead_success",context:n,url:e};i!==!1?o.addGARecordMevt(r.module,r.action,r.context,r.value,r.url):o.trackEventOnPage(r.module,r.action,r.context,r.value)},p=function(){return window.performance&&window.performance.now?function(){return window.performance.now()}:window.performance&&window.performance.webkitNow?function(){return window.performance.webkitNow()}:function(){return(new Date).getTime()}}();return function(){var e=this,n=function(){return e.whatTypeahead?e.whatTypeahead.getInputText():null},l=function(){return e.whereTypeahead?e.whereTypeahead.getInputText():null},f=function(o,a){var r=Math.floor(p()-u);return a=t.merge(a||{},{beforeGeoId:o.beforeGeoId,beforeQuery:o.beforeQuery,afterQuery:n(),durationResultsShown:r}),e&&e.selection&&e.selection.url&&(a.url=e.selection.url),a&&"ALL"===a.type?a.afterGeoId=1:a&&"NEARBY"===a.type?a.afterGeoId=0:a.afterGeoId=e.geoInfo.geoID,a},y=function(e,n,r,s){if(!r){var c=e.options?e.options.startTime:void 0,d=e.lastSuccessfulQuery,u=e.options&&e.options.geoId,h=e.options?e.options.name:void 0,p=e.historyShown,l=t.find("#MASTAHEAD_TYPEAHEAD_START_TIME");l.value=c;var y=t.find("#MASTAHEAD_TYPEAHEAD_UI_ORIGIN");y.value=h;var T=e.options?e.options.searchSessionId:void 0;T||(T="no_search_session_id");var v=f(e,{hadHistory:p,action:"RECORD",eventType:"search_bttn",startTime:c,source:h,query:d,uiOrigin:h,scope:u>=0?u:void 0,searchSessionId:T,url:n,userInteractionType:s});i!==!1?o.addTypeAheadMevt(v):a("/TypeAheadJson",{method:"GET",data:v})}};this.whatTypeahead.options=t.merge(this.whatTypeahead.options,{skipRecordAfterValidate:!0,onSubmit:y}),this.whereTypeahead.options=t.merge(this.whereTypeahead.options,{skipRecordAfterValidate:!0,onSubmit:y}),this.whatTypeahead.options.loggingOverride=function(t,o,a){return!s||s.partial||s.tabSelection||(t.eventType="search_from_masthead",t.url=a),f(e.whatTypeahead,t)}.bind(this),this.whereTypeahead.options.loggingOverride=function(t,o,a){return!s||s.partial||s.tabSelection||(t.eventType="search_from_geo",t.url=a),f(e.whereTypeahead,t)}.bind(this);var T=function(e){e.beforeQuery=n()},v=function(t){t.beforeGeoId=e.geoInfo.geoID};T(e.whatTypeahead),T(e.whereTypeahead),v(e.whatTypeahead),v(e.whereTypeahead),this.on("startSearch",function(t,o,r){if(t){o.options.startTime=(new Date).getTime();var i=e.geoInfo.geoID,s=o.options.name,c=!!(o.options.staticResults&&o.options.staticResults.history&&o.options.staticResults.history.results&&o.options.staticResults.history.results.length),d=o.options?o.options.searchSessionId:void 0;d||(d="no_search_session_id");var u="";"what"===r?(T(o),v(o),u=n()):"where"===r&&(v(o),u=l(),i=1);var h=f(o,{action:"RECORD",eventType:"start",uiOrigin:o.options.name,startTime:o.options.startTime,source:s,hadHistory:c,scope:i,searchSessionId:d,query:u});if(o.options.linkedTypeAhead&&o.options.linkedTypeAhead.options.startTime&&(h.linkedTypeAhead=o.options.linkedTypeAhead.options.startTime),c)try{var p=o.options.staticResults.history.results.map(function(e){return{"value":e.value,"type":e.type,"document_id":e.document_id,"data_type":e.data_type}});h.result=btoa(JSON.stringify(p))}catch(e){h.result=void 0}a({method:"GET",data:h,url:"/TypeAheadJson"})}"where"===r&&(T(o),v(o))}),this.on("resultsRendered",function(t,a,n){if(u=p(),"what"===n&&e.geoInfo&&e.geoInfo.geoID>1)for(var r=0;r<a.length;r++){var i=a[r];"TRAVEL_GUIDE"===i.type&&o.trackEventOnPage("TravelGuides_SearchBar","impression",e.geoInfo.geoID,0,!0)}}),this.on("select",function(o,a){s=a;var n=a.evt&&"click"===a.evt.type?"click":"enter",i={action:"Action",module:(r||"TopNav")+(o===e.whatTypeahead?"_Search":"_geo_search"),context:"Selected_TaA_Result",value:"history"==a.choice.scope?1:0,url:a.url};if(i=f(o,i),a.search&&"click"===n&&(i=t.merge(i,{context:"Search | "+n+" | SeeMore",url:"/Search"})),a.choice){var u=a.choice;u.isChild&&(i=t.merge(i,{action:"NestedListSelected",context:u.type})),"local_tag"===u.scope?i=t.merge(i,{action:"TagSelected",value:u.tagId}):"local_keyword"===u.scope?i=t.merge(i,{action:"KeywordSelected",value:u.indexInType}):"TRAVEL_GUIDE"===u.type&&(i=t.merge(i,{context:i.context+"_TravelGuides"}))}a.partial?c(i):(a.whatQuery&&(i.url="/Search"),d(i))}),this.on("submit",function(t){if(t.redirectUrl&&t.submit_clicked){var o=t&&t.evt?t.evt.type:"enter";y(e.whatTypeahead,t.redirectUrl,!1,o)}h(t&&t.redirectUrl,t&&t.context)})}}});
